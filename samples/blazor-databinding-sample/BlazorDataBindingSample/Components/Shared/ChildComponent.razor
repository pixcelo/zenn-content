@* 子コンポーネント：親からパラメータを受け取り、イベントコールバックで親に通知 *@

<div class="border rounded p-3 @BackgroundClass">
    <h5>子コンポーネント</h5>

    <div class="mb-2">
        <p>親から受け取った値: <strong>@ParentValue</strong></p>
        <p>カウント: <strong>@Count</strong></p>
    </div>

    <div class="mb-2">
        <label class="form-label">子コンポーネント内で入力:</label>
        <input class="form-control" @bind="localValue" @bind:event="oninput" />
    </div>

    <div>
        <button class="btn btn-primary btn-sm" @onclick="IncrementCount">カウント増加</button>
        <button class="btn btn-success btn-sm ms-2" @onclick="NotifyParent">親に通知</button>
    </div>
</div>

@code {
    /// <summary>
    /// 親コンポーネントから受け取る値
    /// </summary>
    [Parameter]
    public string ParentValue { get; set; } = "";

    /// <summary>
    /// カウント値
    /// </summary>
    [Parameter]
    public int Count { get; set; }

    /// <summary>
    /// カウント変更時のコールバック
    /// </summary>
    [Parameter]
    public EventCallback<int> CountChanged { get; set; }

    /// <summary>
    /// 親への通知用コールバック
    /// </summary>
    [Parameter]
    public EventCallback<string> OnNotify { get; set; }

    /// <summary>
    /// 背景色のCSSクラス
    /// </summary>
    [Parameter]
    public string BackgroundClass { get; set; } = "bg-light";

    private string localValue = "";

    private async Task IncrementCount()
    {
        Count++;
        // 双方向バインディングのために CountChanged を呼び出す
        await CountChanged.InvokeAsync(Count);
    }

    private async Task NotifyParent()
    {
        await OnNotify.InvokeAsync($"子コンポーネントから通知: {localValue}");
    }
}
